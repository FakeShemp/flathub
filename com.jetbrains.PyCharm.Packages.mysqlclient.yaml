id: com.jetbrains.PyCharm.Packages.mysqlclient
branch: "20.08"
runtime: com.jetbrains.PyCharm-Community
runtime-version: stable
sdk: org.freedesktop.Sdk//20.08
build-extension: true
appstream-compose: false
build-options: 
  prefix: ${FLATPAK_DEST}
modules:
  - name: mysql
    buildsystem: cmake-ninja
    build-options:
      strip: true
    config-opts:
      - -DBUILD_CONFIG=mysql_release
      - -DWITHOUT_SERVER:BOOL=ON
      - -DWITH_AUTHENTICATION_PAM=OFF
      - -DIGNORE_AIO_CHECK=ON
      - -DCMAKE_INSTALL_PREFIX=/app/packages/mysqlclient/
    cleanup:
      - /man
      - /include
      - /support-files
    sources:
      - type: git
        url: https://github.com/MariaDB/server.git
        tag: mariadb-10.5.5
        commit: 5b3d3792e28fc7a875c7060f772e42a9cd922f83
      - type: patch
        path: pam.patch

  - name: mysqlclient
    buildsystem: simple
    build-options: 
      env: 
        PATH: /app/bin:/usr/bin:/app/packages/mysqlclient/bin
    build-commands:
      - pip3 install --no-index --find-links="file://${PWD}" --target=${FLATPAK_DEST}/python
        mysqlclient
      - install -Dm644 --target-directory=${FLATPAK_DEST}/share/metainfo com.jetbrains.PyCharm.Packages.mysqlclient.metainfo.xml
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/a5/e1/e5f2b231c05dc51d9d87fa5066f90d1405345c54b14b0b11a1c859020f21/mysqlclient-2.0.1.tar.gz
        sha256: fb2f75aea14722390d2d8ddf384ad99da708c707a96656210a7be8af20a2c5e5
        sources:
      - type: file
        path: com.jetbrains.PyCharm.Packages.mysqlclient.metainfo.xml
